/* =========================================
   XOZY-EP STYLESHEET v3.0 (SPACING FIX)
   ========================================= */

/* --- 1. VARIABLES --- */
:root {
  --bg: linear-gradient(135deg, #d8d4c9 0%, #b1b1b1 33%, #c9b98d 66%, #a1a1a1 100%);
  --accent: #ff3e00;
  --ghost: rgba(255, 62, 0, 0.25);
  --magic: #8a2be2;
  --text: #1a1a1a;
  --lcd-bg: #080a08;
  --lcd-text: #39ff14;
  --border: #8e8e8e;
  --panel-bg: rgba(255, 255, 255, 0.45);
  --key-white: #f0f0f0;
  --key-black: #2a2a2a;
}

body.dark-mode {
  --bg: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
  --text: #e0e0e0;
  --border: #444;
  --panel-bg: rgba(30, 30, 30, 0.9);
  --key-white: #aaa;
  --key-black: #000;
}

/* --- 2. LAYOUT --- */
body {
  background: var(--bg);
  background-attachment: fixed;
  color: var(--text);
  font-family: 'IBM Plex Mono', monospace;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  margin: 0;
}

.chassis {
  background: var(--panel-bg);
  border: 2px solid var(--border);
  border-radius: 12px;
  padding: 25px;
  width: 95%;
  max-width: 1100px;
  box-shadow: 20px 20px 60px rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(10px);
  margin: 20px 0;
}

.main-deck {
  display: grid;
  grid-template-columns: 1fr 1.4fr;
  gap: 40px; /* Increased gap between Left and Right decks */
}

.chassis.skinny-mode .main-deck { grid-template-columns: 1fr; }

/* --- 3. HEADER & LCD --- */
.header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
h1 { margin: 0; font-size: 1.2rem; letter-spacing: 4px; font-weight: 900; }
.header-controls { display: flex; gap: 10px; }

.lcd-display {
  background: var(--lcd-bg); color: var(--lcd-text); padding: 12px;
  border-radius: 4px; border: 4px solid #222; width: 100%; height: 60px;
  box-shadow: inset 0 0 20px #000; overflow-y: auto;
  font-family: 'Courier New', monospace; display: flex; flex-direction: column-reverse;
  box-sizing: border-box; margin-bottom: 20px;
}
.log-entry { border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding: 2px 0; font-size: 0.8rem; }

/* --- 4. CONTROLS --- */
.control-group {
  background: rgba(0, 0, 0, 0.05); padding: 15px; border-radius: 8px;
  border: 1px solid var(--border); margin-bottom: 20px;
}
.config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; align-items: end; }
.split-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; align-items: end; }

label { font-size: 0.55rem; font-weight: 800; text-transform: uppercase; margin-bottom: 6px; display: block; opacity: 0.8; }
select, input { width: 100%; padding: 8px; background: var(--bg); border: 1px solid var(--text); color: var(--text); font-weight: bold; font-size: 0.75rem; box-sizing: border-box; }

input[type=range].knob { -webkit-appearance: none; height: 4px; background: var(--text); border-radius: 2px; }
input[type=range].knob::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; background: var(--accent); border-radius: 50%; cursor: pointer; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.5); }
input[type=range].magic-knob::-webkit-slider-thumb { background: var(--magic); border-color: white; }
.magic-label { color: var(--magic); font-weight: 900; }

/* --- 5. PERFORMANCE AREA (Left Deck) --- */
.performance-container {
  display: grid;
  grid-template-columns: 45px 1fr;
  /* FIX: Huge gap between Group Buttons and Pads */
  gap: 50px !important; 
  min-width: 0;
}

.group-strip { display: flex; flex-direction: column; gap: 6px; height: 100%; }
.group-btn {
  flex: 1; background: rgba(0,0,0,0.1); border: 2px solid var(--text);
  border-radius: 4px; color: var(--text); font-weight: 900; cursor: pointer;
  display: flex; align-items: center; justify-content: center; font-size: 0.8rem;
}
.group-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

/* DRUM PADS */
.ep-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  /* FIX: Very tight pads */
  gap: 2px !important; 
}

.pad-btn {
  background: rgba(0,0,0,0.05); border: 2px solid var(--border);
  aspect-ratio: 4/3; max-height: 60px; border-radius: 6px;
  cursor: pointer; position: relative; box-shadow: 0 3px 0 rgba(0,0,0,0.1);
}
.pad-btn.active-pad { border-color: var(--accent); background: var(--accent) !important; color: white; transform: translateY(1px); box-shadow: 0 2px 0 rgba(0,0,0,0.2); }
.pad-btn.hit { filter: brightness(1.5); transform: translateY(2px); box-shadow: none; }

.legend-tag { position: absolute; top: 4px; right: 6px; font-weight: 900; font-size: 0.7rem; opacity: 0.7; }
.pad-btn-sq::before { content: ''; position: absolute; top: 15%; left: 10%; width: 12%; height: 16%; background: var(--accent); border-radius: 1px; }
.active-pad.pad-btn-sq::before { background: white; }

/* --- 6. EDITOR PANEL (Right Deck) --- */
.editor-panel {
  background: rgba(0, 0, 0, 0.03); border: 2px solid var(--border);
  padding: 20px; /* Increased padding */
  border-radius: 8px; flex-grow: 1; display: flex; flex-direction: column;
}

.editor-header {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 15px;
}

/* BIGGER MODE TOGGLES */
.editor-header > div { display: flex; gap: 10px; }
#pad-mode-drum, #pad-mode-chord {
  width: auto !important;
  min-width: 100px !important;
  padding: 12px 24px !important;
  font-size: 0.9rem !important;
  border-width: 2px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* --- 7. PIANO --- */
.piano-wrapper { display: flex; gap: 14px; margin-bottom: 15px; height: 160px; }
.octave-stack { width: 62px; display: flex; flex-direction: column; gap: 10px; }
.oct-btn { flex: 0 0 50px; background: rgba(0,0,0,0.05); border: 2px solid var(--text); color: var(--text); font-weight: 900; cursor: pointer; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
.oct-readout { flex: 1; border: 2px solid var(--border); background: rgba(0,0,0,0.06); border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: 900; font-size: 0.7rem; }
.oct-readout span { font-size: 1.2rem; }

.kb-octave { position: relative; width: 100%; height: 100%; border-radius: 14px; overflow: hidden; }
.kb-whites { position: absolute; inset: 0; display: flex; }
.kb-white { flex: 1; background: var(--key-white); border-right: 1px solid var(--border); cursor: pointer; border-bottom: 4px solid rgba(0,0,0,0.1); }
.kb-blacks { position: absolute; inset: 0; pointer-events: none; }
.kb-black { position: absolute; top: 0; height: 60%; width: 8%; background: #111; border-radius: 0 0 4px 4px; cursor: pointer; pointer-events: auto; border: 1px solid rgba(255,255,255,0.2); }

.kb-white.is-root, .kb-black.is-root { background: var(--accent) !important; }
.kb-white.is-chord, .kb-black.is-chord { background: var(--ghost) !important; }

/* --- 8. SEQUENCER GRID (Full Width Fix) --- */
.step-container {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  gap: 2px;
  
  /* FIX: Force Full Width and let boxes grow */
  width: 100% !important;
  max-width: none !important; 
  margin-top: 20px;
  overflow: visible;
}

.step-box {
  /* Remove fixed aspect ratio to allow stretching if needed, 
     but 1/1 usually looks best. Let's try min-height to ensure they are big. */
  aspect-ratio: 1/1; 
  min-height: 40px; /* Ensure they aren't tiny */
  
  border: 2px solid var(--text);
  display: flex; align-items: center; justify-content: center;
  
  /* Large font */
  font-size: 1rem;
  
  cursor: pointer; font-weight: 900; border-radius: 4px;
  opacity: 0.6; transition: 0.1s;
}

.step-box:hover { opacity: 0.9; transform: scale(0.98); box-shadow: 0 0 8px var(--accent); }
.step-box.on-x { background: var(--accent); color: white; border-color: var(--accent); opacity: 1; }
.step-box.on-y { background: #555; color: white; border-color: #555; opacity: 1; }
.step-box.on-z { color: var(--accent); border-color: var(--accent); border-style: dashed; opacity: 1; }

/* --- 9. BUTTONS --- */
.action-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: auto; padding-top: 20px; }
.btn-main { background: var(--text); color: var(--bg); border: none; padding: 20px; font-weight: 900; cursor: pointer; border-radius: 4px; letter-spacing: 1px; font-size: 0.9rem; width: 100%; border-bottom: 4px solid rgba(0,0,0,0.2); }
.btn-main.primary { background: var(--accent); color: white; }
.btn-main:active { transform: translateY(2px); border-bottom-width: 2px; }

.btn-small { background: #555; color: white; border: none; padding: 12px; font-size: 0.7rem; cursor: pointer; border-radius: 3px; font-weight: bold; width: 100%; }
.btn-layout { background: transparent; border: 2px solid var(--text); color: var(--text); font-weight: bold; padding: 6px 12px; cursor: pointer; border-radius: 4px; font-size: 0.8rem; }
.btn-toggle-on { background: var(--lcd-text) !important; color: black !important; border-color: var(--lcd-text) !important; }

#feedback-btn { position: fixed; bottom: 20px; right: 20px; background: var(--text); color: var(--bg); border: 2px solid var(--border); padding: 10px 20px; font-weight: 900; border-radius: 30px; cursor: pointer; z-index: 100; }
.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 200; align-items: center; justify-content: center; }
.modal-box { background: var(--bg); border: 2px solid var(--accent); width: 90%; max-width: 400px; padding: 30px; border-radius: 12px; display: flex; flex-direction: column; gap: 15px; color: var(--text); }
.modal-title { font-size: 1.2rem; font-weight: 900; border-bottom: 2px solid var(--text); padding-bottom: 10px; }
.modal-input { width: 100%; padding: 12px; background: rgba(0,0,0,0.05); border: 1px solid var(--text); color: var(--text); font-family: inherit; box-sizing: border-box; }
.modal-actions { display: flex; gap: 10px; justify-content: flex-end; }
